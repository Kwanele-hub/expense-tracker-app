{"ast":null,"code":"var _jsxFileName = \"/home/tcg/my-workspace/Team-Serengetti/expense-tracker-app/client/src/app/profile/EditProfile.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { Helmet } from 'react-helmet';\nimport { useForm, Controller } from 'react-hook-form';\nimport * as yup from 'yup';\nimport { Messages } from 'primereact/messages';\nimport { Card } from 'primereact/card';\nimport { Button } from 'primereact/button';\nimport { Dropdown } from 'primereact/dropdown';\nimport { userApiEndpoints, currencyApiEndpoints } from './../../API';\nimport axios from './../../Axios';\nimport { useTracked } from './../../Store';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst updateProfileValidationSchema = yup.object().shape({\n  name: yup.string().required('Name field is required').min(4, 'Name must be at most 4 character'),\n  email: yup.string().required('Email field is required').min(6, 'Email must be at most 6 character'),\n  currency: yup.object().required('Currency field is required')\n});\nlet messages; // For alert message\n\nconst EditProfile = props => {\n  _s();\n\n  var _errors$name, _errors$email, _errors$currency;\n\n  const [state, setState] = useTracked();\n  const {\n    register,\n    handleSubmit,\n    errors,\n    setValue,\n    setError,\n    control\n  } = useForm({\n    validationSchema: updateProfileValidationSchema\n  });\n  const [submitting, setSubmitting] = useState(false);\n  useEffect(() => {\n    requestCurrencies();\n    requestProfileInfo();\n  }, []);\n  const requestCurrencies = useCallback(async () => {\n    if (state.currencies.length === 0) {\n      await axios.get(currencyApiEndpoints.currency, {}).then(response => {\n        // console.log(response.data);\n        if (response.data.data.length > 0) {\n          setState(prev => ({ ...prev,\n            currencies: response.data.data\n          }));\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n  }, [state.currencies.length]);\n\n  const currencyTemplate = option => {\n    return /*#__PURE__*/_jsxDEV(\"span\", {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"color-highlight text-bold\",\n        children: option.currency_code\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 19\n      }, this), \" - \", option.currency_name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 13\n    }, this);\n  };\n\n  const requestProfileInfo = async () => {\n    await axios.get(userApiEndpoints.self, {}).then(response => {\n      // console.log('success', response.data);\n      setValue([{\n        name: response.data.name\n      }, {\n        email: response.data.email\n      }, {\n        currency: response.data.currency\n      }]);\n      let {\n        currency,\n        ...rest\n      } = response.data;\n      setState(prev => ({ ...prev,\n        user: rest\n      }));\n    }).catch(error => {\n      console.log('error', error.response);\n\n      if (error.response.status === 401) {\n        messages.show({\n          severity: 'error',\n          detail: 'Something went wrong. Try again.',\n          sticky: true,\n          closable: true,\n          life: 5000\n        });\n      }\n    });\n  };\n\n  const submitUpdateProfile = data => {\n    data.currency_id = data.currency.id;\n    axios.put(userApiEndpoints.profile, JSON.stringify(data)).then(response => {\n      // console.log('success', response.data.request);\n      if (response.status === 200) {\n        setSubmitting(false);\n        setValue([{\n          name: response.data.request.name\n        }, {\n          email: response.data.request.email\n        }, {\n          currency: state.currencies.find(el => el.id === response.data.request.currency_id ? el : null)\n        }]);\n        let {\n          currency,\n          ...rest\n        } = response.data.request;\n        setState(prev => ({ ...prev,\n          user: rest\n        }));\n        messages.show({\n          severity: 'success',\n          detail: 'Your profile info updated successfully.',\n          sticky: false,\n          closable: false,\n          life: 5000\n        });\n      }\n    }).catch(error => {\n      console.log('error', error.response);\n      setSubmitting(false);\n      messages.clear();\n\n      if (error.response.status === 422) {\n        let errors = Object.entries(error.response.data).map(([key, value]) => {\n          return {\n            name: key,\n            message: value[0]\n          };\n        });\n        setError(errors);\n      } else if (error.response.status === 401) {\n        messages.show({\n          severity: 'error',\n          detail: 'Something went wrong. Try again.',\n          sticky: true,\n          closable: true,\n          life: 5000\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      title: \"Edit Profile\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-grid p-nogutter\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-col-12\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-fluid\",\n          children: /*#__PURE__*/_jsxDEV(Messages, {\n            ref: el => messages = el\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-grid\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-col-12\",\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          className: \"rounded-border\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-card-title p-grid p-nogutter p-justify-between\",\n              children: \"Edit Profile\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-card-subtitle\",\n              children: \"Edit current profile information below.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleSubmit(submitUpdateProfile),\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-fluid\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"name\",\n                children: \"Name\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 160,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                name: \"name\",\n                ref: register,\n                className: \"p-inputtext p-component p-filled\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 161,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-error\",\n                children: (_errors$name = errors.name) === null || _errors$name === void 0 ? void 0 : _errors$name.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-fluid\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"email\",\n                children: \"Email\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 165,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                name: \"email\",\n                ref: register,\n                className: \"p-inputtext p-component p-filled\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-error\",\n                children: (_errors$email = errors.email) === null || _errors$email === void 0 ? void 0 : _errors$email.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 167,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-fluid\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: \"Currency\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 170,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Controller, {\n                name: \"currency\",\n                onChange: ([e]) => {\n                  setState(prev => ({ ...prev,\n                    currentCurrency: e.value\n                  }));\n                  return e.value;\n                },\n                defaultValue: state.currency,\n                control: control,\n                as: /*#__PURE__*/_jsxDEV(Dropdown, {\n                  filter: true,\n                  filterBy: \"currency_code,currency_name\",\n                  filterPlaceholder: \"Search here\",\n                  showClear: true,\n                  filterInputAutoFocus: false,\n                  options: state.currencies,\n                  style: {\n                    width: '100%'\n                  },\n                  itemTemplate: currencyTemplate,\n                  placeholder: \"Select a currency\",\n                  optionLabel: \"currency_code\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 180,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-error\",\n                children: (_errors$currency = errors.currency) === null || _errors$currency === void 0 ? void 0 : _errors$currency.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-fluid\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                disabled: submitting,\n                type: \"submit\",\n                label: \"Update Profile\",\n                icon: \"pi pi-refresh\",\n                className: \"p-button-raised\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 138,\n    columnNumber: 5\n  }, this);\n};\n\n_s(EditProfile, \"m5jTXQApbtGQApnt6Gc4cmCWS+c=\", false, function () {\n  return [useTracked, useForm];\n});\n\n_c = EditProfile;\nexport default _c2 = /*#__PURE__*/React.memo(EditProfile);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"EditProfile\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/home/tcg/my-workspace/Team-Serengetti/expense-tracker-app/client/src/app/profile/EditProfile.jsx"],"names":["React","useEffect","useState","useCallback","Helmet","useForm","Controller","yup","Messages","Card","Button","Dropdown","userApiEndpoints","currencyApiEndpoints","axios","useTracked","updateProfileValidationSchema","object","shape","name","string","required","min","email","currency","messages","EditProfile","props","state","setState","register","handleSubmit","errors","setValue","setError","control","validationSchema","submitting","setSubmitting","requestCurrencies","requestProfileInfo","currencies","length","get","then","response","data","prev","catch","error","console","log","currencyTemplate","option","currency_code","currency_name","self","rest","user","status","show","severity","detail","sticky","closable","life","submitUpdateProfile","currency_id","id","put","profile","JSON","stringify","request","find","el","clear","Object","entries","map","key","value","message","e","currentCurrency","width","memo"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { Helmet } from 'react-helmet';\nimport { useForm, Controller } from 'react-hook-form';\nimport * as yup from 'yup';\n\nimport { Messages } from 'primereact/messages';\nimport { Card } from 'primereact/card';\nimport { Button } from 'primereact/button';\nimport { Dropdown } from 'primereact/dropdown';\n\nimport { userApiEndpoints, currencyApiEndpoints } from './../../API';\nimport axios from './../../Axios';\nimport { useTracked } from './../../Store';\n\nconst updateProfileValidationSchema = yup.object().shape({\n  name: yup.string().required('Name field is required').min(4, 'Name must be at most 4 character'),\n  email: yup.string().required('Email field is required').min(6, 'Email must be at most 6 character'),\n  currency: yup.object().required('Currency field is required'),\n});\n\nlet messages; // For alert message\n\nconst EditProfile = (props) => {\n\n  const [state, setState] = useTracked();\n  const { register, handleSubmit, errors, setValue, setError, control } = useForm({\n    validationSchema: updateProfileValidationSchema\n  });\n  const [submitting, setSubmitting] = useState(false);\n\n  useEffect(() => {\n    requestCurrencies();\n    requestProfileInfo();\n  }, []);\n\n  const requestCurrencies = useCallback(async () => {\n    if (state.currencies.length === 0) {\n      await axios.get(currencyApiEndpoints.currency, {})\n        .then(response => {\n          // console.log(response.data);\n          if (response.data.data.length > 0) {\n            setState(prev => ({ ...prev, currencies: response.data.data }))\n          }\n        })\n        .catch(error => {\n          console.log(error);\n        });\n    }\n  }, [state.currencies.length]);\n\n  const currencyTemplate = (option) => {\n    return (<span><span className=\"color-highlight text-bold\">{option.currency_code}</span> - {option.currency_name}</span>);\n  };\n\n  const requestProfileInfo = async () => {\n    await axios.get(userApiEndpoints.self, {})\n      .then(response => {\n        // console.log('success', response.data);\n        setValue([\n          { name: response.data.name },\n          { email: response.data.email },\n          { currency: response.data.currency },\n        ]);\n        let { currency, ...rest } = response.data;\n        setState(prev => ({ ...prev, user: rest }));\n      })\n      .catch(error => {\n        console.log('error', error.response);\n\n        if (error.response.status === 401) {\n          messages.show({\n            severity: 'error',\n            detail: 'Something went wrong. Try again.',\n            sticky: true,\n            closable: true,\n            life: 5000\n          });\n        }\n\n      })\n  };\n\n  const submitUpdateProfile = (data) => {\n\n    data.currency_id = data.currency.id;\n\n    axios.put(userApiEndpoints.profile, JSON.stringify(data))\n      .then(response => {\n        // console.log('success', response.data.request);\n        if (response.status === 200) {\n          setSubmitting(false);\n          setValue([\n            { name: response.data.request.name },\n            { email: response.data.request.email },\n            { currency: state.currencies.find(el => el.id === response.data.request.currency_id ? el : null) },\n          ]);\n\n          let { currency, ...rest } = response.data.request;\n          setState(prev => ({ ...prev, user: rest }));\n\n          messages.show({\n            severity: 'success',\n            detail: 'Your profile info updated successfully.',\n            sticky: false,\n            closable: false,\n            life: 5000\n          });\n        }\n\n      })\n      .catch(error => {\n        console.log('error', error.response);\n\n        setSubmitting(false);\n\n        messages.clear();\n\n        if (error.response.status === 422) {\n          let errors = Object.entries(error.response.data).map(([key, value]) => {\n            return { name: key, message: value[0] }\n          });\n          setError(errors);\n        }\n        else if (error.response.status === 401) {\n          messages.show({\n            severity: 'error',\n            detail: 'Something went wrong. Try again.',\n            sticky: true,\n            closable: true,\n            life: 5000\n          });\n        }\n\n      })\n  };\n\n  return (\n    <div>\n      <Helmet title=\"Edit Profile\" />\n\n      <div className=\"p-grid p-nogutter\">\n        <div className=\"p-col-12\">\n          <div className=\"p-fluid\">\n            <Messages ref={(el) => messages = el} />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-grid\">\n\n        <div className=\"p-col-12\">\n          <Card className=\"rounded-border\">\n            <div>\n              <div className=\"p-card-title p-grid p-nogutter p-justify-between\">Edit Profile</div>\n              <div className=\"p-card-subtitle\">Edit current profile information below.</div>\n            </div>\n            <br />\n            <form onSubmit={handleSubmit(submitUpdateProfile)}>\n              <div className=\"p-fluid\">\n                <label htmlFor=\"name\">Name</label>\n                <input type=\"text\" name=\"name\" ref={register} className=\"p-inputtext p-component p-filled\" />\n                <p className=\"text-error\">{errors.name?.message}</p>\n              </div>\n              <div className=\"p-fluid\">\n                <label htmlFor=\"email\">Email</label>\n                <input type=\"text\" name=\"email\" ref={register} className=\"p-inputtext p-component p-filled\" />\n                <p className=\"text-error\">{errors.email?.message}</p>\n              </div>\n              <div className=\"p-fluid\">\n                <label>Currency</label>\n                <Controller\n                  name=\"currency\"\n                  onChange={([e]) => {\n                    setState(prev => ({ ...prev, currentCurrency: e.value }));\n                    return e.value;\n                  }}\n                  defaultValue={state.currency}\n                  control={control}\n                  as={\n                    <Dropdown\n                      filter={true}\n                      filterBy=\"currency_code,currency_name\"\n                      filterPlaceholder=\"Search here\"\n                      showClear={true}\n                      filterInputAutoFocus={false}\n                      options={state.currencies}\n                      style={{ width: '100%' }}\n                      itemTemplate={currencyTemplate}\n                      placeholder=\"Select a currency\"\n                      optionLabel=\"currency_code\"\n                    />\n                  }\n                />\n                <p className=\"text-error\">{errors.currency?.message}</p>\n              </div>\n              <div className=\"p-fluid\">\n                <Button disabled={submitting} type=\"submit\" label=\"Update Profile\" icon=\"pi pi-refresh\" className=\"p-button-raised\" />\n              </div>\n            </form>\n          </Card>\n        </div>\n\n      </div>\n    </div>\n\n  )\n}\n\nexport default React.memo(EditProfile);\n"]},"metadata":{},"sourceType":"module"}